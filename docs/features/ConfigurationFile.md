# Конфигурирование BSL Language Server

BSL Language Server предоставляет возможность изменения настроек, заложенных разработчиками, с помощью конфигурационного
файла в формате json.  
Созданный файл необходимо указать с помощью ключа `--configuration ` *(или кратко `-c`)* при запуске BSL Language Server
в качестве консольного приложения либо, если же используется редактор/IDE с плагином-клиентом BSL Language Server,
разместить его в соответствии с документацией *(обычно это корень проекта либо рабочей области)*.

В случае отсутствия конфигурационного файла будет предпринята попытка найти файл ".bsl-language-server.json" в "
%HOMEPATH%"

## Описание настроек

| Наименование                                                   |            Тип             | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|:---------------------------------------------------------------|:--------------------------:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `language`                                                     |          `Строка`          | Этот параметр устанавливает язык отображения диагностированных замечаний. На данный момент поддерживаются два языка:<br/>* `ru` - для русского языка (*используется по умолчанию*)<br/>* `en` - для английского языка                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `codeLens`                                                     |       `JSON-Объект`        | Содержит настройки отображения `линз` в продвинутых кода/IDE *(например [Visual Studio Code](https://code.visualstudio.com/))*, в которых выводится различная информация над блоком кода.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ⤷&nbsp;&nbsp;&nbsp;`parameters`                                |       `JSON-Объект`        | Коллекция настроек линз. Элементами коллекции являются json-объекты следующей структуры:<br/>* *ключ объекта* - строка, являющаяся идентификатором линзы<br/>* *значение объекта* - может принимать либо булево значение, и тогда интерпретируется как отключение линзы (`false`) или ее включение с параметрами по умолчанию (`true`), либо значение типа `json-объект`, представляющего собой набор настроек линзы.                                                                                                                                                                                                                          |
| &nbsp;&nbsp;&nbsp;⤷&nbsp;&nbsp;&nbsp;`cognitiveComplexity`     | `Булево` или `JSON-Объект` | Включает отображение значения [когнитивной сложности](../diagnostics/CognitiveComplexity.md) метода над его определением. По умолчанию настройка установлена в `true`. Доступные параметры линзы: `complexityThreshold` - порог, после которого линза начинает срабатывать. Значение параметра по умолчанию - `-1`.                                                                                                                                                                                                                                                                                                                            |
| &nbsp;&nbsp;&nbsp;⤷&nbsp;&nbsp;&nbsp;`cyclomaticComplexity`    | `Булево` или `JSON-Объект` | Включает отображение значения [цикломатической сложности](../diagnostics/CyclomaticComplexity.md) метода. По умолчанию настройка установлена в `true`. Доступные параметры линзы: `complexityThreshold` - порог, после которого линза начинает срабатывать. Значение параметра по умолчанию - `-1`.                                                                                                                                                                                                                                                                                                                                            |
| `diagnostics`                                                  |       `JSON-Объект`        | Содержит настройки диагностик                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ⤷&nbsp;&nbsp;&nbsp;`computeTrigger`                            |          `Строка`          | С помощью этого параметра можно указать событие, при котором будет вызвана процедура анализа кода для диагностирования замечаний. Возможные значения:<br/>* `onType` - при редактировании файла (онлайн) ***на больших файлах может ЗНАЧИТЕЛЬНО замедлять редактирование***<br/>* `onSave` - при сохранении файла (*используется по умолчанию*)<br/>* `never` - анализ выполняться не будет                                                                                                                                                                                                                                                    |
| ⤷&nbsp;&nbsp;&nbsp;`ordinaryAppSupport`                        |          `Булево`          | Поддержка обычного клиента. Диагностики будут требовать учитывать особенности обычного приложения. Возможные значения:<br/>* `true` - конфигурация разрабатывается с поддержкой обычного клиента *(установлен по умолчанию)* <br/>* `false` - игнорировать предупреждения связанные с особенностями обычного клиента                                                                                                                                                                                                                                                                                                                           |
| ⤷&nbsp;&nbsp;&nbsp;`skipSupport`                               |          `Строка`          | Этим параметром настраивается режим пропуска файлов *(т.е. файлы не анализируются на предмет наличия замечаний)* **конфигурации 1С**, находящихся "на поддержке" конфигурации поставщика. Возможные значения:<br/>* `withSupport` - пропускаются все модули, находящиеся "на поддержке" *(все виды "замков")*<br/>* `withSupportLocked` - пропускаются только модули, находящиеся "на поддержке" с запретом изменений *("желтый закрытый замок")*<br/>* `never` - режим поддержки не анализируется и модули не пропускаются *(установлен по умолчанию)*                                                                                        |
| ⤷&nbsp;&nbsp;&nbsp;`mode`                                      |          `Строка`          | Настройка для управления режимом учета настроек диагностик. Возможные варианты:<br/>* `OFF` - Все диагностики считаются выключенными, вне зависимости от их настроек <br/>* `ON` - Все диагностики включенные по умолчанию считаются включенными, остальные - в зависимости от личных настроек <br/>* `EXCEPT` - Все диагностистики, кроме указанных, считаются включенными <br/>* `ONLY` - Только указанные диагностики считаются включенными <br/>* `ALL` - Все диагностики считаются включенными                                                                                                                                            |
| ⤷&nbsp;&nbsp;&nbsp;`parameters`                                |       `JSON-Объект`        | Параметр представляет собой коллекцию настроек диагностик. Элементами коллекции являются json-объекты следующей структуры:<br/>* *ключ объекта* - строка, являющаяся ключом диагностики<br/>* *значение объекта* - может принимать либо булево значение, и тогда интерпретируется как отключение диагностики (`false`) или ее включение с параметрами по умолчанию (`true`), либо значение типа `json-объект`, представляющего собой набор настроек диагностики.<br/><br/>Ключ, включена ли по умолчанию, а также описание возможных параметров и примеры для конфигурационного файла представлены на странице с описанием каждой диагностики. |
| ⤷&nbsp;&nbsp;&nbsp;`overrideMinimumLSPDiagnosticLevel`         |          `Строка`          | Этот параметр позволяет задать минимальный уровень серьезности для LSP диагностик. Если уровень диагностики ниже указанного, он будет повышен до указанного. Возможные значения:<br/>* `INFO` - информация<br/>* `MINOR` - незначительная<br/>* `MAJOR` - значительная<br/>* `CRITICAL` - критическая<br/>* `BLOCKER` - блокирующая<br/><br/>По умолчанию параметр не задан и уровни диагностик используются согласно их определению.                                                                                                                                                        |
| ⤷&nbsp;&nbsp;&nbsp;`metadata`                                  |       `JSON-Объект`        | Параметр представляет собой коллекцию переопределений метаданных диагностик. Элементами коллекции являются json-объекты следующей структуры:<br/>* *ключ объекта* - строка, являющаяся ключом диагностики<br/>* *значение объекта* - json-объект с переопределяемыми параметрами диагностики. Можно переопределить: `type`, `severity`, `scope`, `modules`, `minutesToFix`, `activatedByDefault`, `compatibilityMode`, `tags`, `canLocateOnProject`, `extraMinForComplexity`.<br/><br/>Значения из конфигурационного файла накладываются поверх заданных в исходном коде.                                          |
| ⤷&nbsp;&nbsp;&nbsp;`subsystemsFilter`                          |       `JSON-Объект`        | Фильтр по подсистемам конфигурации                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ⤷&nbsp;&nbsp;&nbsp;`analyzeOnStart`                            |          `Булево`          | Запустить анализ всего проекта при запуске сервера. Если включено, после построения контекста на клиента будет отправлена информация о диагностиках во всех файлах проекта.                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| &nbsp;&nbsp;&nbsp;⤷&nbsp;&nbsp;&nbsp;`include`                 |     `Массив` `Строка`      | Список имен подсистем по объектам которых выполняется анализ, включая подчиненные подсистемы                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| &nbsp;&nbsp;&nbsp;⤷&nbsp;&nbsp;&nbsp;`exclude`                 |     `Массив` `Строка`      | Список имен подсистем исключенных из анализа, включая подчиненные подсистемы                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `documentLink`                                                 |       `JSON-Объект`        | Содержит настройки ссылок на документацию                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ⤷&nbsp;&nbsp;&nbsp;`showDiagnosticDescription`                 |          `Булево`          | Показывать дополнительные ссылки на документацию по диагностикам. По умолчанию параметр выключен (*установлен в `false`*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `inlayHint`                                                    |       `JSON-Объект`        | Содержит настройки отображения `inlay hints` в продвинутых редакторах кода/IDE *(например [Visual Studio Code](https://code.visualstudio.com/))*, в которых выводится различная информация прямо в строке с кодом.                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ⤷&nbsp;&nbsp;&nbsp;`parameters`                                |       `JSON-Объект`        | Коллекция настроек inlay hints. Элементами коллекции являются json-объекты следующей структуры:<br/>* *ключ объекта* - строка, являющаяся идентификатором inlay hint<br/>* *значение объекта* - может принимать либо булево значение, и тогда интерпретируется как отключение inlay hint (`false`) или их включение с параметрами по умолчанию (`true`), либо значение типа `json-объект`, представляющего собой набор настроек inlay hint.                                                                                                                                                                                                    |
| &nbsp;&nbsp;&nbsp;⤷&nbsp;&nbsp;&nbsp;`cognitiveComplexity`     | `Булево` или `JSON-Объект` | Включает отображение значения [когнитивной сложности](../diagnostics/CognitiveComplexity.md) метода в виде inlay hints. По умолчанию настройка установлена в `true`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| &nbsp;&nbsp;&nbsp;⤷&nbsp;&nbsp;&nbsp;`cyclomaticComplexity`    | `Булево` или `JSON-Объект` | Включает отображение значения [цикломатической сложности](../diagnostics/CyclomaticComplexity.md) метода в виде inlay hints. По умолчанию настройка установлена в `true`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| &nbsp;&nbsp;&nbsp;⤷&nbsp;&nbsp;&nbsp;`sourceDefinedMethodCall` | `Булево` или `JSON-Объект` | Включает отображение параметров вызываемого метода конфигурации/библиотеки в виде inlay hints. По умолчанию настройка установлена в `true`. Доступные параметры:<br/>* `showParametersWithTheSameName` - отображать параметры с именами, содержащимися в передаваемом значении. Значение параметра по умолчанию - `false`.<br/>* `showDefaultValues` - отображать значения по умолчанию для непереданных параметров. Значение параметра по умолчанию - `true`.                                                                                                                                                                                 |
| `useDevSite`                                                   |          `Булево`          | При включении настройки формирующиеся ссылки на документацию будут вести на develop-версию сайта. По умолчанию параметр выключен (*установлен в `false`*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `siteRoot`                                                     |          `Строка`          | Путь к корню сайта с документацией. По умолчанию параметр имеет значение `"https://1c-syntax.github.io/bsl-language-server"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `traceLog`                                                     |          `Строка`          | Для логирования всех запросов *(входящих и исходящих)* между **BSL Language Server** и **Language Client** из используемого редактора/IDE, в этом параметре можно указать путь к файлу лога. Путь можно указывать как абсолютный, так и относительный *(от корня анализируемого проекта)*, по умолчанию значение не заполнено.<br/><br/>**ВНИМАНИЕ**<br/><br/>* При запуске **BSL Language Server** перезаписывает указанный файл<br/>* Скорость взаимодействия между клиентом и сервером **ЗНАЧИТЕЛЬНО ЗАМЕДЛЯЕТСЯ**                                                                                                                          |
| `configurationRoot`                                            |          `Строка`          | Данный параметр предназначен для указания корневого каталога, в котором находятся файлы конфигурации 1С в каталоге проекта. Может быть полезен в случае нахождения нескольких каталогов конфигураций в одном каталоге проекта либо при сложной структуре каталога проекта. По умолчанию параметр не заполнен и `BSL Language Server` самостоятельно определяет расположение корневого каталога конфигурации                                                                                                                                                                                                                                    |
| `sendErrors`                                                   |          `Строка`          | Режим отправки сообщений об ошибках разработчикам BSL Language Server. Подробнее - на странице [Мониторинг и отправка ошибок](Monitoring.md). Возможные значения:<br/>* `ask` - спрашивать разрешение при каждой ошибке *(установлен по умолчанию)*. <br/>* `send` - всегда отправлять сообщения об ошибках. <br/>* `never` - никогда не отправлять сообщения об ошибках.                                                                                                                                                                                                                                                                      |

Для облегчения составления и редактирования конфигурационного файла можно использовать следующую JSON-схему:

```log
https://1c-syntax.github.io/bsl-language-server/configuration/schema.json
```

## Пример

Ниже приведен пример настройки:

* Устанавливает язык сообщений диагностик - английский;
* Изменяет настройку диагностики [LineLength - Ограничение на длину строки](../diagnostics/LineLength.md), устанавливая
  предел длины строки в 140 символов;
* Отключает диагностику [MethodSize - Ограничение на размер метода](../diagnostics/MethodSize.md).
* Включает расчет диагностик в непрерывном режиме (`computeTrigger = onType`)
* Диагностики рассчитываются только по объектам подсистемы "СтандартныеПодсистемы" за исключением "ВариантыОтчетов" и "
  ВерсионированиеОбъектов"
* Устанавливает минимальный уровень серьезности диагностик в `MAJOR` (значительная)
* Переопределяет тип диагностики `EmptyCodeBlock` на `ERROR` и серьезность на `BLOCKER`

```json
{
  "$schema": "https://1c-syntax.github.io/bsl-language-server/configuration/schema.json",
  "language": "en",
  "diagnostics": {
    "computeTrigger": "onType",
    "overrideMinimumLSPDiagnosticLevel": "MAJOR",
    "parameters": {
      "LineLength": {
        "maxLineLength": 140
      },
      "MethodSize": false
    },
    "metadata": {
      "EmptyCodeBlock": {
        "type": "ERROR",
        "severity": "BLOCKER"
      }
    },
    "subsystemsFilter": {
      "include": [
        "СтандартныеПодсистемы"
      ],
      "exclude": [
        "ВариантыОтчетов",
        "ВерсионированиеОбъектов"
      ]
    }
  }
}
```
