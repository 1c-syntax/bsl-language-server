# Добавление параметров для диагностики

Некоторые диагностики могут иметь параметры, позволяющие конечным пользователям настраивать алгоритм работы.  
В качестве примера, возможным параметром может быть максимальная длина строки для замечания на длинные строки, перечень числовых констант, не являющихся магическими числами.

## Реализация параметра диагностики

Для реализации параметра диагностики, необходимо внести следующие изменения в файлы, реализующие диагностику.

### Доработка класса диагностики

В класс диагностики необходимо добавить константное поле, в котором будет сохранено значение параметра по-умолчанию.
Например `private static final String DEFAULT_COMMENTS_ANNOTATION = "//@";`.

Необходимо добавить приватное поле, в котором будет хранится значение параметра. Поле необходимо аннотировать `@DiagnosticParameter` и указать тип параметра, значение по умолчанию (значение всегда строкового типа), а также описание параметра.  
Например

```java
@DiagnosticParameter(
    type = String.class,
    defaultValue = "" + DEFAULT_COMMENTS_ANNOTATION,
    description = "Пропускать комментарии-аннотации, начинающиеся с указанных подстрок. Список через запятую. Например: //@,//(c)"
  )
  private String commentsAnnotation = DEFAULT_COMMENTS_ANNOTATION;

```

Следующим шагом, необходимо реализовать метод установки значения `configure`.  
Например

```java
 @Override
  public void configure(Map<String, Object> configuration) {
    if (configuration == null) {
      return;
    }

    this.commentsAnnotation = (String) configuration.getOrDefault("commentsAnnotation", commentsAnnotation);
  }

```

### Доработка тестов

Обязательно нужно добавить тест для случая изменения настроек диагностики.  
Тест добавляется во все тот же класс теста диагностики _(отдельный метод для каждой комбинации вариантов настроек диагностики)_. В начале теста необходимо выполнить установку значения параметра диагностики, последующие действия аналогичны общим правилам написания тестов.  
Для установки параметра диагностики из теста необходимо получить конфигурацию диагностики по-умолчанию, используя метод `getDefaultDiagnosticConfiguration()` из метаданных текущей диагностики `diagnosticInstance.getInfo()`. Затем выполнить изменение значения параметра, путем добавления в коллекцию конфигурации, а затем переконфигурировать текущую диагностику, обратившись к методу `configure`.  
Пример

```java
// получение текущей конфигурации диагностики
Map<String, Object> configuration = diagnosticInstance.getInfo().getDefaultDiagnosticConfiguration();

// установка нового значения
configuration.put("commentsAnnotation", "//(с)");

// переконфигурирование
diagnosticInstance.configure(configuration);

```

### Доработка документации

Добавление информации о параметрах диагностики в документацию вручную не требуется: после добавления/изменения параметров диагностики необходимо запустить gradlew задачу `updateDiagnosticDocs`, которая самостоятельно выполнит необходимые правки.
