# Добавление параметров для диагностики

Некоторые диагностики могут иметь параметры, позволяющие конечным пользователям настраивать алгоритм работы.  
В качестве примера, возможным параметром может быть максимальная длина строки для замечания на длинные строки, перечень числовых констант, не являющихся магическими числами.

## Реализация параметра диагностики

Для реализации параметра диагностики, необходимо внести следующие изменения в файлы, реализующие диагностику.

### Доработка класса диагностики

В класс диагностики необходимо добавить константное поле, в котором будет сохранено значение параметра по-умолчанию.
Например `private static final String DEFAULT_COMMENTS_ANNOTATION = "//@";`. 

Необходимо добавить приватное поле, в котором будет хранится значение параметра. Поле необходимо аннотировать `@DiagnosticParameter` и указать тип параметра, значение по умолчанию (значение всегда строкового типа), а также описание параметра.  
Например

```java
@DiagnosticParameter(
    type = String.class,
    defaultValue = "" + DEFAULT_COMMENTS_ANNOTATION,
    description = "Пропускать комментарии-аннотации, начинающиеся с указанных подстрок. Список через запятую. Например: //@,//(c)"
  )
  private String commentsAnnotation = DEFAULT_COMMENTS_ANNOTATION;

```

Следующим шагом, необходимо реализовать метод установки значения `configure`.  
Например

```java
 @Override
  public void configure(Map<String, Object> configuration) {
    if (configuration == null) {
      return;
    }

    this.commentsAnnotation = (String) configuration.getOrDefault("commentsAnnotation", commentsAnnotation);
  }

```

### Доработка тестов

Обязательно нужно добавить тест для случая изменения настроек диагностики.  
Тест добавляется во все тот же класс теста диагностики _(отдельный метод для каждой комбинации вариантов настроек диагностики)_. В начале теста необходимо выполнить установку значения параметра диагностики, последующие действия аналогичны общим правилам написания тестов.  
Для установки параметра диагностики из теста необходимо получить конфигурацию диагностики по-умолчанию, используя метод `DiagnosticProvider.getDefaultDiagnosticConfiguration()` для текущей диагностики `getDiagnosticInstance()`. Затем выполнить изменение значения параметра, путем добавления в коллекцию конфигурации, а затем переконфигурировать текущую диагностику, обратившись к методу `configure`.  
Пример

```java
// получение текущей конфигурации диагностики
Map<String, Object> configuration = DiagnosticProvider.getDefaultDiagnosticConfiguration(getDiagnosticInstance());

// установка нового значения
configuration.put("commentsAnnotation", "//(с)");

// переконфигурирование
getDiagnosticInstance().configure(configuration);

```

### Доработка документации

Все параметры диагностики в обязательном порядке должны быть отражены в ее описании (для обоих поддерживаемых языков). В соответствии с шаблоном, это может выглядеть так  

```md
## Параметры

* `commentsAnnotation` - `Строка` - Пропускать комментарии, начинающиеся с указанных подстрок. Список через запятую. Значение по-умолчанию: `//@`.
```
